import fetch from 'node-fetch';

var handler = async (m, { conn, text }) => {
    if (!text) throw `โ๏ธ *ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนููุงู ุงููุงูุฌุง ุงูุชู ุชุฑูุฏ ุงูุจุญุซ ุนููุง!*`;

    conn.reply(m.chat, '๐ *ุฌุงุฑู ุงูุจุญุซ ุนู ุงููุงูุฌุง... ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ*', m);

    let res = await fetch('https://api.jikan.moe/v4/manga?q=' + text);
    if (!res.ok) throw 'โ *ุนุฐุฑูุงุ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุงูุฌุง ุงููุทููุจุฉ!*';

    let json = await res.json();

    // โ ุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ูุชุงุญุฉ ูุจู ูุญุงููุฉ ุงุณุชุฎุฏุงููุง
    if (!json.data || json.data.length === 0) {
        throw 'โ *ุนุฐุฑูุงุ ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ูุชุงุฆุฌ ููุฐู ุงููุงูุฌุง. ุญุงูู ุงูุจุญุซ ุจุงุณู ูุฎุชูู!*';
    }

    let manga = json.data[0]; // ุฃูู ูุชูุฌุฉ ูู ุงูุจุญุซ
    let { chapters, url, type, score, scored, scored_by, rank, popularity, members, background, status, volumes, synopsis, favorites } = manga;

    let ุงูุนููุงู = manga.titles.map(jud => `${jud.title} [${jud.type}]`).join('\n');
    let ุงููุคูู = manga.authors.map(author => `${author.name} (${author.url})`).join('\n');
    let ุงูููุน = manga.genres.map(genre => `${genre.name}`).join(', ');

    let ูุนูููุงุช_ุงููุงูุฌุง = `๐ *ุงูุนููุงู:* ${ุงูุนููุงู}
๐ *ุนุฏุฏ ุงููุตูู:* ${chapters || 'ุบูุฑ ูุชููุฑ'}
๐ *ุนุฏุฏ ุงููุฌูุฏุงุช:* ${volumes || 'ุบูุฑ ูุชููุฑ'}
๐ *ุงูุชุตููู:* ${ุงูููุน || 'ุบูุฑ ูุญุฏุฏ'}
๐ *ุงูุญุงูุฉ:* ${status || 'ุบูุฑ ูุชููุฑ'}
โญ *ุงูุชูููู:* ${score || 'ุบูุฑ ูุชููุฑ'} (${scored || 'ุบูุฑ ูุชููุฑ'} ูู ${scored_by || 'ุบูุฑ ูุชููุฑ'} ูุณุชุฎุฏู)
๐ *ุงูุชุฑุชูุจ:* ${rank || 'ุบูุฑ ูุชููุฑ'}
๐ฅ *ุงูุดุนุจูุฉ:* ${popularity || 'ุบูุฑ ูุชููุฑ'}
๐ฅ *ุนุฏุฏ ุงูุฃุนุถุงุก:* ${members || 'ุบูุฑ ูุชููุฑ'}
๐ *ุงูููุถูุฉ:* ${favorites || 'ุบูุฑ ูุชููุฑ'}
โ๏ธ *ุงููุคูู:* ${ุงููุคูู || 'ุบูุฑ ูุชููุฑ'}
๐ *ุงูุฑุงุจุท:* [ุงุถุบุท ููุง](${url})
๐ *ุงููุตู:* ${synopsis || 'ูุง ููุฌุฏ ููุฎุต ูุชุงุญ'}
`;

    // โ ุฅุฑุณุงู ุตูุฑุฉ ุงููุงูุฌุง ูุน ุงููุนูููุงุช
    conn.sendFile(m.chat, manga.images.jpg.image_url, 'manga.jpg', `๐ *ูุนูููุงุช ุงููุงูุฌุง:*\n` + ูุนูููุงุช_ุงููุงูุฌุง, m);
    
    // โ ุฅุฑุณุงู ุฑุณุงูุฉ ุฏุนู ูููุทูุฑ
    conn.reply(m.chat, '๐ก *ูุง ุชูุณู ุฏุนู ูุทูุฑ ุงูุจูุช!*\n๐ค *Xnuvers007*\n๐ [ุงุฏุนู ุงููุทูุฑ ููุง](https://saweria.co/xnuvers007)', m);
};

handler.help = ['ูุนูููุงุช_ุงููุงูุฌุง <ุงุณู ุงููุงูุฌุง>', 'ูุงูุฌุง <ุงุณู ุงููุงูุฌุง>'];
handler.tags = ['anime'];
handler.command = /^(mangainfo|manga|infomanga|ูุงูุฌุง)$/i;

export default handler;